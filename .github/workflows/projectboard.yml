name: issue-to-project-board-workflow
on:
  # Trigger when an issue gets labeled or deleted
  issues:
    types: [reopened, closed, labeled, unlabeled, assigned, unassigned]

jobs:
  setup_matrix_input:
    runs-on: ubuntu-latest

    steps:
      - id: set-matrix 
        run: |
          output=$(curl https://api.github.com/repos/BennyDeBock/blog/issues/1/labels | jq '.[] | .name')

          echo '======================'
          echo 'Process incoming data'
          echo '======================'
          json=$(echo [$output] | sed 's/"\s"/","/g')
          echo $json

          echo '======================'
          echo 'Split string into array'
          echo '======================'
          SAVEIFS=$IFS
          IFS=',' read -ra my_array <<< "$json"
          IFS=$SAVEIFS

          for i in "${my_array[@]}"
          do
              echo $i 
          done
          echo "::set-output name=matrix::{\"include\":$(echo $json)}"
    outputs:
      issueTags: ${{ steps.set-matrix.outputs.matrix }}
      
  Manage_project_issues:
    needs: setup_matrix_input
    uses: BennyDeBock/ci/.github/workflows/issues-to-project-board.yml@main
    with:
      labelsJson: ${{ needs.setup_matrix_input.outputs.issueTags }}